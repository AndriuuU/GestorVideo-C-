@page "/devices"
@using VideoMatrix.Models
@using VideoMatrix.Services
@inject DeviceService DeviceService

<PageTitle>Dispositivos</PageTitle>
<h3>Dispositivos</h3>

<div class="device-grid">
    <h4>Transmisores</h4>
    <div class="grid">
        @if (transmitters == null)
        {
            <p>Cargando transmisores...</p>
        }
        else if (!transmitters.Any())
        {
            <p>No se encontraron transmisores.</p>
        }
        else
        {
            @foreach (var transmitter in transmitters)
            {
                <div class="grid-item">
                    <h5>@transmitter.Name (@transmitter.IpAddress)</h5>
                    @if (transmitter.Status == DeviceStatus.On)
                    {
                        <img src="@transmitter.ImageUrl" alt="Transmitter Image" />
                    }
                    else
                    {
                        <p>Estado: @transmitter.Status</p>
                    }
                </div>
            }
        }
    </div>

    <h4>Receptores</h4>
    <div class="grid">
        @if (receivers == null)
        {
            <p>Cargando receptores...</p>
        }
        else if (!receivers.Any())
        {
            <p>No se encontraron receptores.</p>
        }
        else
        {
            @foreach (var receiver in receivers)
            {
                <div class="grid-item">
                    <h5>@receiver.Name (@receiver.IpAddress)</h5>
                    @if (receiver.Status == DeviceStatus.On)
                    {
                        <img src="@receiver.ImageUrl" alt="Receiver Image" />
                    }
                    else
                    {
                        <p>Estado: @receiver.Status</p>
                    }
                </div>
            }
        }
    </div>
</div>

@code {
    private List<Transmitter> transmitters;
    private List<Receiver> receivers;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            transmitters = await DeviceService.GetTransmittersAsync();
            receivers = await DeviceService.GetReceiversAsync();
        }
        catch (Exception ex)
        {
            // Manejo de errores
            Console.WriteLine($"Error al inicializar datos: {ex.Message}");
        }
    }
}
